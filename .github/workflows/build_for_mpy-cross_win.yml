#===================================================================================
# https://github.com/ccccmagicboy/MicroPython_fw_action
# Description: Build MicroPython firmware using GitHub Actions for PYBV11
# Lisence: MIT
# Author: ccccmagicboy
# Url: https://ccrobot-online.com
#===================================================================================

name: mpy-cross_win_BUILD

on:
  push:
    branches:
      - master
  # schedule:
    # - cron: 0 8 * * 5
  # watch:
    # types: [started]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout this repos
      uses: actions/checkout@v2    

    - name: Clone the micropython source code
      run: git clone --depth 1 https://github.com/micropython/micropython.git -b master my_micropython

    - name: Get the python3
      uses: actions/setup-python@v1
      with:
        python-version: '3.x'
        architecture: 'x64'      

    - name: check python version
      run: |
        python -c "import sys; print(sys.version)"
        echo %PYTHONHOME%
        echo %PATH%
        
    - name: Down the toolchain and set the gcc path
      run: |
        curl -o toolchain.zip https://dl.espressif.com/dl/esp32_win32_msys2_environment_and_toolchain-20180110.zip
        7z x toolchain.zip
        dir
        echo "::add-path::.\msys32\opt\xtensa-esp32-elf\bin"
        echo "::add-path::.\msys32\usr\bin\"

    - name: Make the mpy-cross
      run: |        
        cd my_micropython
        make -C mpy-cross