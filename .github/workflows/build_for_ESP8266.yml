#===================================================================================
# https://github.com/ccccmagicboy/MicroPython_fw_action
# Description: Build MicroPython firmware using GitHub Actions for PYBV11
# Lisence: MIT
# Author: ccccmagicboy
# Url: https://ccrobot-online.com
#===================================================================================

name: ESP8266_BUILD

on:
  release:
    types: [published]
  push:
    branches:
      - master
  # schedule:
    # - cron: 0 8 * * 5
  # watch:
    # types: [started]

env:
  REPO_URL: https://github.com/micropython/micropython.git
  REPO_BRANCH: master
  TOOLCHAIN_REPO_URL: https://github.com/pfalcon/esp-open-sdk.git
  TOOLCHAIN_REPO_BRANCH: master  
  TZ: Asia/Shanghai

jobs:
  build:
    runs-on: ubuntu-16.04

    steps:
    - name: Checkout this repos
      uses: actions/checkout@v2    
      
    - name: Install require for toolchain
      run: |
        sudo apt-get install make unrar-free autoconf automake libtool gcc g++ gperf \
        flex bison texinfo gawk ncurses-dev libevpat-dev python-dev sed git unzip \
        bash help2man wget bzip2 libtool-bin

    - name: Clone the toolchain source code
      run: git clone --recursive $TOOLCHAIN_REPO_URL -b $TOOLCHAIN_REPO_BRANCH my_toolchain

    - name: Build the toolchain
      run: |
        cd my_toolchain
        ls -al
        make

      
    - name: Clone the micropython source code
      run: git clone --depth 1 $REPO_URL -b $REPO_BRANCH my_micropython
